# 华为云PaaS微服务治理技术 - P146：06.mesher研究-mesher作为消费方-处理流程 - 开源之家 - BV1wm4y1M7m5

好，那下面呢我们就开始mesure的研究。呃，mat的研究呢，我们通过几个方面来进行啊。那这个研究的方法是这样的，我先说一下，当初我们在介绍servfacemat的时候，呃。

我们说是不是有这个servfacemat的这个应用场景主要有3个，对吧？哪三个呢就是呃这个servfacemat作为消费方啊来调用其他的微服务，对吧？

还有一个就是servfacemat作为提供方来被其他微服务所调用。😊。

![](img/5a085fe65e486df42da77e30bde039c0_1.png)

![](img/5a085fe65e486df42da77e30bde039c0_2.png)

![](img/5a085fe65e486df42da77e30bde039c0_3.png)

![](img/5a085fe65e486df42da77e30bde039c0_4.png)

![](img/5a085fe65e486df42da77e30bde039c0_5.png)

好，最后一个就是不管是消费方还是服务提供方，是都采用这个s分 match。

![](img/5a085fe65e486df42da77e30bde039c0_7.png)

啊，s维mat这个三个场景呢，我们其实主要研究前两个场景就可以了。因为第三个场景你可以看到第三个场景的话，是不是就是前两个场景的一个合并。



![](img/5a085fe65e486df42da77e30bde039c0_9.png)

![](img/5a085fe65e486df42da77e30bde039c0_10.png)

是吧所以我们在啊研究memesure的时候呢，我们也通过两个方面哎，一个是mesure作为消费方来调用其他微服务。😊。



![](img/5a085fe65e486df42da77e30bde039c0_12.png)

哎，我们研究一下它的方法是怎么实现的。另外一个方法就是说mesure作为提供方啊，其他的服务如何去调用它啊。😊。



![](img/5a085fe65e486df42da77e30bde039c0_14.png)

也就是说，一个消费方式去调用其他人其他服务，而这个提供方式就是被其他服务所调用。

![](img/5a085fe65e486df42da77e30bde039c0_16.png)

好，那么呃注意这两个方法，只要我们学会了，那么所mattter作为既作为这个服务提供方，又作为服务消费方。那那大家应该也就会了。所以我们把这两个研究一下。首先我们先看第一个叫mesure作为消费方。

meer作为消费方的这个图呢，大家可以看到啊。首先呢一个消费方啊，这个消费方呢大家知道它一定是不具备微服务能力的对吧？他要通过measure呢哎来使自己具备微服务的能力。

而measure呢它是一个代理哎，它这个负责哎向外界的这个微服务呢发起请求，它同时啊同时怎么弄啊？它会去连接注册中心服务注册中心来找到他所调用的服务的地址，然后呢，meer进行调用，好。

大概是这样一个流程。😊，那这个上面这个图的这个调用的过程是怎么做的呢？首先，consumer哎他要请求measure啊，请求measure他的请求地址呢就是HTTP冒号杠杠微服务名称。😊。

而measure呢，他就拿着微服务的名称从这个服务注册中心去找哎，找到这个prorovvider。如果找到了这个measure呢就开始去调用provider。

最后measure把调用的结果呢给这个consumer返回。这样的话是不是就是一个代理的这个一个一个一个作用，对吧？好，那这就是measure作为消费方，它的这个什么啊这个这个调用的流程。好。

上面再来看measure作为消费者调用其他微服务啊，它的具体的实现的步骤是什么呢？😊。

![](img/5a085fe65e486df42da77e30bde039c0_18.png)

实现的步骤。

![](img/5a085fe65e486df42da77e30bde039c0_20.png)

实验步骤是什么？第一要设置HTTP代理是啥意思呀？你想想这个consumer，它如果不设置HTTP代理的话，他是不是就直接去调用它了？😊。



![](img/5a085fe65e486df42da77e30bde039c0_22.png)

所以现在我们肯定不让他直接掉呀，他不让他直接掉，能怎么办？对，要在consumer这里边要设置一个什么代理哎，设置一个代理设置代理的话，那这样的话。

凡是从consumer去发出的HTTP请求都会通过这个这个什么me这个代理来向其他服务发起。所以第一步要做的就是这个在通过代理哎，在消费方。😊。



![](img/5a085fe65e486df42da77e30bde039c0_24.png)

![](img/5a085fe65e486df42da77e30bde039c0_25.png)

在消费方啊要设置HTTB代理，通过HTB代理发起HTTP请求。那这个代理肯定是什么measure了，对不对？所以这个HTP代理的地址呢就是mesure。😊。



![](img/5a085fe65e486df42da77e30bde039c0_27.png)

![](img/5a085fe65e486df42da77e30bde039c0_28.png)

嗯，有人说老师那怎么设置代理呢？稍后呢我给你演示啊啊，比如说我们当初用的这个rest template啊，那那个也可以设置一个代理啊，设置这个mesure的代理地址呢。

那从这个consumer发起的请求呢都会走meature。😊。

![](img/5a085fe65e486df42da77e30bde039c0_30.png)

![](img/5a085fe65e486df42da77e30bde039c0_31.png)

好，那接下来还有一个点呢，还有一个开发的步骤。第二步呢就是要在你你设置完代理是不是要调用啊，你这个调用的地址啊，一定不要通过IP和端口的方式了，一定要通过微服务名称。这样的话，这个measure呢。

他拿到这个微服务的名称之后呢，他就开始从服务的注册中心是不是去找这个服务了。😊。

![](img/5a085fe65e486df42da77e30bde039c0_33.png)

![](img/5a085fe65e486df42da77e30bde039c0_34.png)

这个就是我们说的这个measure作为啊消费方他的这个请求的流程。

![](img/5a085fe65e486df42da77e30bde039c0_36.png)

好。

![](img/5a085fe65e486df42da77e30bde039c0_38.png)