# 01 RHCE8.0视频教程【45课时】 - P45：20200517-RHCE-06_recv - 六竹书生6682 - BV1m84y1f7ss

![](img/50e1fde6bd44518bea22bf919d035d2b_0.png)

那行这边的话呢，我们现在接下去看一下这个叫做角色，之前的话呢我们有看过那个用现有的一些角色，就是说在什么站点去下载啊，这边也跟大家去说过了嘛，然后下面这边的话呢呃我们来看一下，比如说在我们的系统当中。

它已有的一些角色的话呢，有哪一些以及角色的结构的话呢是怎么样子的。

![](img/50e1fde6bd44518bea22bf919d035d2b_2.png)

给大家再来看一下LS我们的root unstable，然后这里有rules，然后这里的话呢是我自己去创建的，不是这个etc unstable rules，里面什么都没有吗。

Leetc enable enable config，我来看一下，去匹配一下吧，叫做grape rolees，Etc ensable rose，他这边的话呢就说应该是有rose的。

By default avironment，Rose will be visible，就是说全局是可见的，但这边的话呢县里面就说一个都没有，一个都没有，那这边的话呢先不管他。

我之前的话呢好像是去安装了一些角色，在我们root enable，然后呢rose下面有个XTT，它的一个MYSQL之前装过的，这边的话呢你看它是不是都会有一些这个角色，这个就是我们的一个角色名字。

角色名字的话里面就一个一个目录嘛，你看这个hunter还记得吗，就说到时候想要去触发哪些动作吗，对吧，然后接下来mt的话呢，这个里面是去存放什么东西呢，他会去存放一些，就是嗯不常用。

他的话呢就是说当前角色的一些特殊定义，会放在这个mate当中去，不常用，然后这个task主要就是一个任务嘛，然后这边templates就是一些哦模板模板文件。

就比如说我们对一个设备安装了一个HTTP之后，接下去的话呢可能希望在那台设备上的话呢，去进行一个配置，因为不同设备的话呢，我可能配的东西是不一样的，那我可以去生成这个模板的配置文件。

到时候再进行一个下发嘛，这边的话呢还有一个VR，就是什么和它的一些变量相关的，就好像我们之前写了一个叫做VR压码文件吗，他这个的话呢。



![](img/50e1fde6bd44518bea22bf919d035d2b_4.png)

是把它放到特定的目录当中去的啊，所以的话呢这边我们先来了解一下像这个角色，他其实的话呢就是说一系列目录，目录里面的话呢，一系列文件，然后再加上叫做最外层的诶。



![](img/50e1fde6bd44518bea22bf919d035d2b_6.png)

等一下，就说再加上最外层的这种叫做main文件。

![](img/50e1fde6bd44518bea22bf919d035d2b_8.png)

去进行一个协调，加上main文件，就之前的话呢，你们应该基本上都有接触过一些C语言对吧，C语言的话呢一开始在写的时候，是不是基本上就是include什么什么什么东西，就然后的话呢在main函数当中。

我们就说去使用一系列的方法，对不对，它其实这个的话呢还是蛮像的，就说我们的话呢去把这一系列东西给写起来，到时候的话呢我去把它include起来，在这个叫做rose总体的一个协调文件当中的话呢。



![](img/50e1fde6bd44518bea22bf919d035d2b_10.png)

是不是就可以把所有的东西都给应用起来了呀。

![](img/50e1fde6bd44518bea22bf919d035d2b_12.png)

他就是这样子的一个思想，好吧，那行下面这边的话呢咱们来看一下第一个def。

![](img/50e1fde6bd44518bea22bf919d035d2b_14.png)

像以前老一点的版本之，他们那边的话呢是没有这个default文件的，我们现在这个unstable的话呢，是什么样的一个版本呢，version诶，这里是一个2。9点几版本比较高，以前的话呢1。

5版本的话呢，是没有这个divorce的，好像我记得好吗，还是有啊，我给忘了，应该是没有看到吧，然后像这个default里面的话呢，它是去定一些变量的，确定一些变量，但这这里面去定义的变量的话呢。

它的优先级是比较低的，比我们那个叫做VR当中去定义的变量还低。

![](img/50e1fde6bd44518bea22bf919d035d2b_16.png)

知道吧，定义变量应该是有，他这里的话呢优先级最低，然后接下去的话呢收到变量，我们是不是还有一个叫做vs啊，它这里面的话呢也是去定义一个变量的，它的一个叫做优先级的话呢叫高，啧啧啧。



![](img/50e1fde6bd44518bea22bf919d035d2b_18.png)

然后的话呢它这里面在定义的时候呢，就是一个main文件来进行一个定义，main文件，其实这里的话呢task它有很多的哦，动作的文件嘛，其实在main文件当中去进行了一个调用。



![](img/50e1fde6bd44518bea22bf919d035d2b_20.png)

然后呢最终的话呢我们再写一个大的妹妹键，把所有的妹妹键呢给包含进来好吧。

![](img/50e1fde6bd44518bea22bf919d035d2b_22.png)

然后他这个VR的话呢叫做这里他没有写M文件。

![](img/50e1fde6bd44518bea22bf919d035d2b_24.png)

它这边的话呢就是一个一个的文件嘛，他这个叫做DEFENCE，它的优先级低，后续比如说我们的话呢在，playbook中，对同一个变量进行了定义一下，啧啧啧，你们觉得会去优选playbook里面的呢。

还是DEFORCE里面的呢，这边要注意一下，优选我们playbook里面定义的，也就是说这个diverse的话呢，它真的是非常非常的低，然后接下去如果说在这个VR目录下面去定义的，它的优先级是比较高的。

后续如果说我们在play book当中，也去定义了相应变量，它的话呢是优选谁的呢，优选这个VR目录下面去定义的变量，因为他的优先级的话呢高嘛，哎等一下我想去对它标注一下，知道吧。

这两个目录的话呢有点区别。

![](img/50e1fde6bd44518bea22bf919d035d2b_26.png)

然后下面这边的话呢嗯他没有去写，我们之前在进行一些文件拷贝的时候啊，大家还记不记得我的话呢，去创建了一个files的一个文件。



![](img/50e1fde6bd44518bea22bf919d035d2b_28.png)

对不对，那到时候呢这个文件直接拷贝过去就可以了吗，在这个rose下面的话呢，如果我们去定一个FS的一个文件，它是怎么样呢，包含就是说我们任务当中要去引用的静态文件，存放任务中。

要引用的静态文件就不去改变的好吧，然后下面这里的话呢说到文件。

![](img/50e1fde6bd44518bea22bf919d035d2b_30.png)

我们的话呢是不是刚才说到了一个模板文件。

![](img/50e1fde6bd44518bea22bf919d035d2b_32.png)

这个模板模这这里面的话呢，它存放的就是说我们在任务在做任务的时候，比如说在下发配置文件的时候，有些参数不是要去进行一个调整吗，这里任务引用的金加二的一个文件，好吧，到时候会说啊，这是另一种。

然后接下去的话呢我们再来看一下这个文件呢，我们说完了下面这里pandas。

![](img/50e1fde6bd44518bea22bf919d035d2b_34.png)

这里这个的话呢。

![](img/50e1fde6bd44518bea22bf919d035d2b_36.png)

也就是说到时候执行某个动作的时候呢，想要去触发的操作嘛，它其实也是一个动作对吧，然后还有的话呢就这个META，他这里面的话呢就包含了角色的相关信息，就比如说我这个角色，我这个角色的话，那是谁创建的。

许可证是谁啊，平台是谁啊，还有的话呢依赖信息嘛，所以这里面的话呢就是一些特殊的设定，还有的话呢一些平台的信息，这边的话呢我们目前不去学它好吧。



![](img/50e1fde6bd44518bea22bf919d035d2b_38.png)

这有我们来看一下吧，叫做less啊，Root enable，root x t t mentor啊，main文件，你看这就写运行的平台名字对吧，还有的话我在glass上面去进行一个发布的话呢。

它的一个标签是什么，好吧好。

![](img/50e1fde6bd44518bea22bf919d035d2b_40.png)

然后下面这边的话呢，我们再来看一下其他的一个目录啊。

![](img/50e1fde6bd44518bea22bf919d035d2b_42.png)

叫做他这边有还有没有什么目录啊，Template task。

![](img/50e1fde6bd44518bea22bf919d035d2b_44.png)

Task，我们来看一下，task的话呢大家都知道，也就是说是去定义任务的吗，定义任务的我这里面的话呢。



![](img/50e1fde6bd44518bea22bf919d035d2b_46.png)

就比如说有很多个任务，我可以有这个man来进行一个协调，那里面的话呢，就说到时候我这里面所有的小任务，他的一个执行顺序是怎么样子的，你看这里不是用include嘛对吧，是不是include我的话呢。

再来给你们看一下，诶等一下用LL吧，这个的话那就什么意思呢，首先我到时候执行任务的时候，先去执行CONFIG在哪里哦，在这CONFIG的一个任务文件，再去执行和安全安装相关的一个文件。

再去执行安装数据库，就说main文件的话呢，就说我这个目录里面的所有文件怎么样去用，去协调一下好吧。

![](img/50e1fde6bd44518bea22bf919d035d2b_48.png)

这没有问题哈，然后的话呢下面这边就这几个，就这几个这几个目录稍微注意一下哈，其他的话呢嗯也没有什么样的一个问题，我们的话呢就说来进行一个简单的一个介绍吧，好不好，来进行一个简单的介绍，去创建一个角色吧。

我这边在创建角色之前呢，我们先来看一下，就是说这边的话呢是一个角色，它的一个结构是这样子的，下面因为在我们红帽版本当中的话呢，不仅仅我们可以去平台上去下载红帽的，而光盘中也存在角色。

可以让我们去进行一个使用，直接去进行一个使用吗，我们的话呢首先第一步要去进行一下挂载，挂载完了之后的话呢，这些系统角色的话呢它就会去出来了哈，那行我把这边的话呢叫做样样的话呢去写一下。



![](img/50e1fde6bd44518bea22bf919d035d2b_50.png)

Etc yum reporters，这里的话呢AA有了哈，那我来month一下d v CD room，到我们的s o yin store，它的话呢我先来list一下，我不太记得这个名字了哈，list啊。

新号应该是叫做h e l system moon，然后应该有弱吧，我来查一下先哈。

![](img/50e1fde6bd44518bea22bf919d035d2b_52.png)

有没有。

![](img/50e1fde6bd44518bea22bf919d035d2b_54.png)

诶等一下你们看啊，这边的话呢有那就应该是这个包了哈，Available，现在嘛那就对他的话去进行一个install安装。



![](img/50e1fde6bd44518bea22bf919d035d2b_56.png)

等他安装完毕之后呢，我们就说去找一下它里面的一些默认角色嘛。

![](img/50e1fde6bd44518bea22bf919d035d2b_58.png)

好这边的话呢安装完了，它安装完了之后的话呢，角色是存在在哪里呢，L s user shell，我们的answerable若下面，你看就有12348十十个角色吗，有这十个角色。

我这边的话呢稍微简单的跟大家说一下。

![](img/50e1fde6bd44518bea22bf919d035d2b_60.png)

这些角色的话呢，它有什么样的一个特点。

![](img/50e1fde6bd44518bea22bf919d035d2b_62.png)

第一个先来看这个叫做KDMP。

![](img/50e1fde6bd44518bea22bf919d035d2b_64.png)

诶对，这个KDP的话呢，目前所有的功能的话呢全都是可以支持的，全面支持，然后的话呢它主要是干嘛呢，就是说在我们系统崩溃的时候，崩溃恢复的服务的时候就进行一个使用，崩溃恢复时候使用而崩溃恢复服务吧好吧。



![](img/50e1fde6bd44518bea22bf919d035d2b_66.png)

然后接下去的话呢。

![](img/50e1fde6bd44518bea22bf919d035d2b_68.png)

第二个就是我们的一个叫做network嘛，他这个的话呢也是全面支持的，全都是可以去进行一个使用的，然后这个的话呢主要就是说配置网络接口吗，然后接下来的话呢还有一个叫做POSTFIX。



![](img/50e1fde6bd44518bea22bf919d035d2b_70.png)

![](img/50e1fde6bd44518bea22bf919d035d2b_71.png)

boss fix的话呢，大家都知道是不是和邮件服务相关的，就说为每个主机配置邮件传输代理，传输代理，因为我们这个课的话没有讲到邮件，大家的话呢可以去看一下，这传输代理的话是什么意思。

也就是说我把邮件的话呢发到某一台设备上，到时候再去转发到中央服务器上面去嘛，这个的话呢目前我们是不能用的，他这个的话呢只是一个技术预览啊，就是说后续的话呢他有想过去开发这个角色。

只是说现在的话呢不能去进行一个使用而已，好吧，技术预览，有计划去进行一个开发，那好下面这边的话呢还有一个服务叫做SALINUX，这个大家的话呢都知道是什么东西，相关的安全相关的吗。

这个的话呢目前也是全面支持的，他的话呢就是说去定义我们sea linux的端口啊，还有的话布尔值啊，还有的话就上下文的值啊。



![](img/50e1fde6bd44518bea22bf919d035d2b_73.png)

全都是可以的，接下来的话呢还有一个叫做TSYNC。

![](img/50e1fde6bd44518bea22bf919d035d2b_75.png)

这个的话呢就是说时间同步嘛，这个的话呢也是全面支持的，就说去配置时间同步，然后接下来的话呢我们再来看一下。



![](img/50e1fde6bd44518bea22bf919d035d2b_77.png)

叫做诶哦这里KDP没问题啊，network perfec好像都讲了。

![](img/50e1fde6bd44518bea22bf919d035d2b_79.png)

123455个都讲了，然后他这边的话呢还有几个没有去列出来哈，以后的话呢在以后的一些版本，或者就是说软件在升级的时候呢，会有一个firework，他的话呢也计划在进行一个开发，就防火墙的一个配置吗。

还有这边的话呢叫做TUNED，我们的一个系统调优也是在开发中，因为像这些模块的话呢，就是说经常会去用到它的话呢，希望进行一个开发，那好这里没问题，现在的话呢就比如说我们安装了角色之后。



![](img/50e1fde6bd44518bea22bf919d035d2b_81.png)

我们想要去看某一个角色吗，叫做LLLL啊，user shell叫做unstable，Rose，比如说HEL点network吃一下吧，你看它这个结构是不是基本上组成的defence library。

就是一些模块不管它，然后task test的话呢就是一些测试的信息嘛，好吧它就它也就这些结构，也就这些结构，接下去的话呢嗯我们就比如说去看呃，某一些信息，他这边的话呢不是会有一些叫做read me嘛。

就一个帮助信息嘛，我们来看一个看我们比较容易能看懂的，时间同步吧，它的话呢有一个叫做read me，就里面的话呢他就会去写，里面的话呢他就会去写来一些参数啊。



![](img/50e1fde6bd44518bea22bf919d035d2b_83.png)

一些属性啊，它的一个作用是怎么样子的，好吧去用，如果说后续呢你想要直接去进行一个调用的话，不应该是CHE，应该是less吧，LESS或者VIM吧。



![](img/50e1fde6bd44518bea22bf919d035d2b_85.png)

您看这里时间同步他就说了一些话，warning提醒roll它的一个变量，下面这里的话呢，是不是就是我去设置的一个变量，Post name，这里的话呢就是说要和其他同步的NTP服务器。

这个house name or address of service吗。

![](img/50e1fde6bd44518bea22bf919d035d2b_87.png)

时间同步服务器稍等哈，我去记录一下，后面的话呢它其实都有去进行一个解释，时间同步服务器，然后接下去的话呢我们这边叫做minimum。



![](img/50e1fde6bd44518bea22bf919d035d2b_89.png)

最小的一个时间拉取间隔吗，最大的对吧，这个ibs st什么意思啊。

![](img/50e1fde6bd44518bea22bf919d035d2b_91.png)

Enable fast initial，也就是说我们的话呢去开启时间同步的加速。

![](img/50e1fde6bd44518bea22bf919d035d2b_93.png)

啧，这边的话呢可以看到默认的话呢它是一个NO，他是个NO，但是这边的话已经把你改成一个yes了哈，那好接下去的话呢就这个poor里面的话呢，可能就会解析到很多的一个地址嘛，对不对，所以的话呢。

这边如果你想要去进行一个修改的话呢，就可以在这里的话去进行一个修改呃，就是说不是修改这边的话呢，就告诉你它里面的一些参数的话呢，有什么样的一个含义吗，好吧，其他东西的话呢你们可以自己去进行查看。

其他的一些角色的话呢，自己去进行一些查看哈，然后下面这边的话呢，我们来创建一个自己想要的一个角色。

![](img/50e1fde6bd44518bea22bf919d035d2b_95.png)

还有半个小时时间，我们来练一下自定义角色。

![](img/50e1fde6bd44518bea22bf919d035d2b_97.png)

我们这边的话呢就是说虽然已经安装了HTTP。

![](img/50e1fde6bd44518bea22bf919d035d2b_99.png)

在工作当中的话呢，可能比较多的是不要去安装一个NGX啊，那这边的话呢我们比如说想要去创建一个角色，这个角色的话呢能去做什么样的一个操作呢，第一个，能帮我们去创建用户和组，就说让NG呢。

它由特定的用户和组去进行一个操作，虽然这个用户和组呢在创建的时候，是不是就写一个文件也是可以的，我们为了功能更加清晰的时候，把这两个就是说创建用户和组呢变成两个task，去创建我们的压码文件，可以吧。

然后接下来他的这个用户和组创建完了之后，我们要干嘛呢，就去安装我们的NGX吗，好吧就安装软件包，那他这里的话呢就一个就够了吗，然后接下去第三个，那我这个都已经安装完了，我可能想要去进行一些配置。

就好像我们刚才template嘛配置文件下发对吧，那好这里一个就行了啊，稍等一下，那这边的话呢，就是说去进行一个copy copy就可以了吗，然后接下去第四个我安装完了，配置完了。

是不是要做的事情就去启动服务啊，因为上面这边的话呢，虽然在启动服务的时候，有一个叫做active和一个enable嘛，我们这边上面因为已经练了两个文件了，下面这边的话呢我们就练一个就好了好吧。

就大致掌握一下流程嘛，那好现在的话呢我们来做一下。

![](img/50e1fde6bd44518bea22bf919d035d2b_101.png)

首先在我们的这个control上。

![](img/50e1fde6bd44518bea22bf919d035d2b_103.png)

我们要去创建角色吧，稍等一下，这里创建角色，那这个角色的话呢放在哪里呢。

![](img/50e1fde6bd44518bea22bf919d035d2b_105.png)

大家可以看到刚才哦，就是说之前我去进行一个下载的话呢，角色下载过来在我家目录下rose下面嘛对吧，但是在我们的answerable它的一个配置文件当中，他有去进行对你们去进行一个建议的建议。

你们安装在哪里呢，安装在这个etc answerable rose下面，unstable rose下面好吧。



![](img/50e1fde6bd44518bea22bf919d035d2b_107.png)

所以这里的话呢，我们就说在这下面去进行一个安装，而在这下面的话呢去创建一个目录，就是说去创建一个角色目录嘛，稍等一下，我把没用的给删了。



![](img/50e1fde6bd44518bea22bf919d035d2b_109.png)

然后接下去的话呢呃目录我们是已经看到了，接下来我们比如说make dir etc enerable rose，这边的话呢，对我们的engine可是去进行一个管理的话呢，比如说我们创建的一个角色的名字。

就直接叫这个好吧，诶如果说你这边的话呢，还有一些HTTP服啊，或者vs FTP服啊，你这边目录的话呢，自己去多创建几个就可以了，好我这边index好像之前已经创建过了，我来一个下划线new吧，好吧。

这里ELS你看是不是就有一个nginx new啊。

![](img/50e1fde6bd44518bea22bf919d035d2b_111.png)

没问题，其实你放在哪里都可以，我这边的话呢就放在我们的index下面哦不对。

![](img/50e1fde6bd44518bea22bf919d035d2b_113.png)

建议的一个目录下面，等一下我去复制一下。

![](img/50e1fde6bd44518bea22bf919d035d2b_115.png)

咕咕咕，那好，这边的话呢创建完毕了，我们的话呢等一下要去做的一个操作，第一个是不是有一个叫做呃用户管理的，它是一个task，第二个安装的它也是一个task吧，第三个他是不是要配置的。

是不是也是一个task对吧，然后的话呢只是说在第三个这一块的话呢，我们要去进行一个模板的下发，所以等一下呢再建一个template就可以了嘛，对不对，所以这边来看一下，去把里面的一个结构的话呢。

咱们可以先去创建出来，因为提前已经规划好了吗。

![](img/50e1fde6bd44518bea22bf919d035d2b_117.png)

定义结构，来我CD到etc enerable rule index，牛这里面来，现在的话呢全都是空的，那好midi刚说过要去创建任务，所以需要有task us，第二个的话呢。

因为等一下我们要去存放一些模板文件，所以需要有一个TEMPL对吧，然后其他的话呢就没有什么样的一个东西了，没有什么样的一个东西了，那行就这样子，稍等哈，Tree，诶。



![](img/50e1fde6bd44518bea22bf919d035d2b_119.png)

哦对对对，没问题，就这个。

![](img/50e1fde6bd44518bea22bf919d035d2b_121.png)

现在接下去的话呢我们先去写第一个压码文件。

![](img/50e1fde6bd44518bea22bf919d035d2b_123.png)

CD是不是应该进入tasks，比如说BM一个文件，这个的话呢主要是对我们的用户去进行管理的。

![](img/50e1fde6bd44518bea22bf919d035d2b_125.png)

你看我们平时的话呢，是不是希望某个用户的话呢，去加入到某个组当中去啊，那这个组的话呢是不是先去给它生成会好一点，因为这样子的话就是说先生成组，我把他的一个id去指定一下，然后再去生成一个用户id的话呢。

也去指定一下，就这样子的话呢，id就不会乱，我们平时的话会比较多的，先去创建组，然后的话呢再去把用户加到组里面去嘛。



![](img/50e1fde6bd44518bea22bf919d035d2b_127.png)

这边我们的话呢先去创建我们的小组，因为其实你这个脚本谁写前，谁写后的话呢。

![](img/50e1fde6bd44518bea22bf919d035d2b_129.png)

没有关系，我指示的话呢，等一下调用顺序是这样的。

![](img/50e1fde6bd44518bea22bf919d035d2b_131.png)

我就提前按照这种顺序呢给大家写一下好吧，第一个我想要去创建一个小组。

![](img/50e1fde6bd44518bea22bf919d035d2b_133.png)

诶等一下这边的话呢小组在创建的时候。

![](img/50e1fde6bd44518bea22bf919d035d2b_135.png)

我们上面那个什么remove，还有呢叫做host就不用去写了，我们很简单的，在这里就写一个任务的名字是什么，比如说correct nginx group，然后呢我的一个动作是什么呢。

是不是使用我们的group模块啊，name比如说等于NGINX，我来看一下，因为这个的话呢呃DNGX它不存在，然后我来看一下，叫做80也没有，也就是说80这个的话呢现在是没人用的嘛。

我就把NGINX它的一个id的话呢指定为80好吧，因为这个是等一下要去运行我们的一个应用的。

![](img/50e1fde6bd44518bea22bf919d035d2b_137.png)

他这个的话呢肯定是要作为一个系统用户嘛。

![](img/50e1fde6bd44518bea22bf919d035d2b_139.png)

稍等哈，那好就这样子的一个结构就行了，其他的我们啥也不要。

![](img/50e1fde6bd44518bea22bf919d035d2b_141.png)

接下去组创建好了，我们是不是要去创建我们的用户了，User，user的话呢，那肯定操作就和他一样了嘛，回车第一个，应用的名字，比如说correct user index。

然后的话呢调用user的一个模块，第一个叫做名字叫什么呢，Nginx，第二个叫做它的话呢，我们是不是可以去定一下它的一个UID是多少，比如说和我们组名是一样的，82，主id是一样的80。

然后第三个它的一个组组，直接就是我的index就可以了，组组这个的话呢我希望它是一个系统用户嘛，第三个因为它是运行一个应用的，是不是很容易遭受人攻击啊，比如说这个用户的话呢，权限被获取了之后。

我不希望他能登录到我的系统，是不是这个s being NO login就可以了，就这样子。

![](img/50e1fde6bd44518bea22bf919d035d2b_143.png)

所以这边的话呢在创建用户的时候，咱们去设置这些值就可以了。

![](img/50e1fde6bd44518bea22bf919d035d2b_145.png)

好吧，我们去设置这些值就行了。

![](img/50e1fde6bd44518bea22bf919d035d2b_147.png)

你的话呢一行写过去也行。

![](img/50e1fde6bd44518bea22bf919d035d2b_149.png)

像我这样子分开写也行，我两种格式都给大家写一下。

![](img/50e1fde6bd44518bea22bf919d035d2b_151.png)

那好，然后接下去的话呢，是不是要想办法去安装我们的NX软件了。

![](img/50e1fde6bd44518bea22bf919d035d2b_153.png)

那这边我再去写一个雅马文件，比如说yy ml。

![](img/50e1fde6bd44518bea22bf919d035d2b_155.png)

等一下哈。

![](img/50e1fde6bd44518bea22bf919d035d2b_157.png)

然后里面的话呢它也简单name，比如说install nginx soft package，然后呢使用的模块是不是我们的YM模块，name等于NGINX。



![](img/50e1fde6bd44518bea22bf919d035d2b_159.png)

默认情况下是不是就是一个安装的呀，那好其他啥也不做了吗。

![](img/50e1fde6bd44518bea22bf919d035d2b_161.png)

好保存退出，接下去的话呢。

![](img/50e1fde6bd44518bea22bf919d035d2b_163.png)

嗯我们把这个叫做模板文件的话呢，等一下去写，他等一下的话呢，是不是就是说要去启动一下我们的一个服务啊，启动一下我们的服务嘛，那这边我们来写一下启动我们的一个服务。



![](img/50e1fde6bd44518bea22bf919d035d2b_165.png)

一个叫做start点y ml回车，Name，比如说start，SERVISE这边的话呢，是不是就是SERVICE服务的名字，就是NGX，就这样就好了。



![](img/50e1fde6bd44518bea22bf919d035d2b_167.png)

等一下我看一下在哪，YM哦，对，在启动服务。

![](img/50e1fde6bd44518bea22bf919d035d2b_169.png)

对其实有时候的话呢。

![](img/50e1fde6bd44518bea22bf919d035d2b_171.png)

万一这个服务已经被安装起来了，或者的话已经启动了，我可能模板文件修改了，我是不希望他去重启一下。

![](img/50e1fde6bd44518bea22bf919d035d2b_173.png)

所以这边的话呢我们可以再去写一个restart，好吧，这边vm restart的一个文件，然后这边的话呢就去诶，我好像state没写哈，刚才冲动了，我去改一下，等一下。

你看这边i state等于restart，然后呢enable等于two就可以了吗。

![](img/50e1fde6bd44518bea22bf919d035d2b_175.png)

线应该没漏掉了。

![](img/50e1fde6bd44518bea22bf919d035d2b_177.png)

我把那个start文件的去补一下，啧啧啧。

![](img/50e1fde6bd44518bea22bf919d035d2b_179.png)

好吧。

![](img/50e1fde6bd44518bea22bf919d035d2b_181.png)

那好这里的话呢就这样子啊，服务安装也安装了，启动的话呢也做了，接下来的话呢，我们是不是希望就是说嗯。

![](img/50e1fde6bd44518bea22bf919d035d2b_183.png)

有一个模板文件去进行一个下发嘛对吧，那首先我们要去创建我们的一个模板文件，叫做templates里面吗，啧啧先去创建哎。



![](img/50e1fde6bd44518bea22bf919d035d2b_185.png)

先去给它创建起来，所以这边就是说CD etc enable rose index，Task templates，诶哦不是不是，task templates先进来。



![](img/50e1fde6bd44518bea22bf919d035d2b_187.png)

![](img/50e1fde6bd44518bea22bf919d035d2b_188.png)

那好这里面的话呢现在没有什么样的一个东西，我在本地的话呢，NGINX之前已经提前安装了，你们到时候自己练习的时候也去安装一下NGINX，NGINXCONFIG拷贝到我当前目录下面来。

等一下对拷贝到我当前目录下面来，名字的话呢也叫做index config，因为我们等一下的话，你要去改一些东西嘛，增加二好吧，先拷贝过来。



![](img/50e1fde6bd44518bea22bf919d035d2b_190.png)

我们想要去看是不是真的，这个模板文件生效了吗。

![](img/50e1fde6bd44518bea22bf919d035d2b_192.png)

好现在这里的话呢，我们来编辑一下这个模板文件。

![](img/50e1fde6bd44518bea22bf919d035d2b_194.png)

因为它这里的话呢，和普通的静态文件不一样的地方，就是哦里面的一些文，里面的一些信息是被我去改过的。

![](img/50e1fde6bd44518bea22bf919d035d2b_196.png)

用变量去改过的吗，好吧，回车这边的话呢我们来看一个work，就是说进程管理嘛，也就是说去骑几个进程，auto的话呢，默认就是说好像是根据你的一个CPU的个数，它去进行一个启动的。

我们现在的话呢比如说来看一下。

![](img/50e1fde6bd44518bea22bf919d035d2b_198.png)

这边我来补充一部啊，补充一部查看设备的CPU信息，然后呢在他的一个基础上加一个二多。

![](img/50e1fde6bd44518bea22bf919d035d2b_200.png)

让他去启动几个好吧，这边的话呢呃诶这里有web2012，这小组m setup，然后这边的话呢我就去fl pr，叫做和我们的CPU相关的。



![](img/50e1fde6bd44518bea22bf919d035d2b_202.png)

![](img/50e1fde6bd44518bea22bf919d035d2b_203.png)

等一下稍等一下，你看默认情况下。

![](img/50e1fde6bd44518bea22bf919d035d2b_205.png)

这个叫做CPU的话呢，是不是只有一个，那好我这边的话呢，就在这个变量的基础上面去加二。

![](img/50e1fde6bd44518bea22bf919d035d2b_207.png)

看一下，他等一下进程是不是真的启动了三三个嘛，是不是真的启动了三个好吧，这里把它给放进来哈，加二就可以了，就这里。



![](img/50e1fde6bd44518bea22bf919d035d2b_209.png)

![](img/50e1fde6bd44518bea22bf919d035d2b_210.png)

等一下是不是三个。

![](img/50e1fde6bd44518bea22bf919d035d2b_212.png)

然后接下去的话呢，这边就是说去保存退出了吗，好吧，那我们的话呢就是说模板文件去进行了修改，接下去模板文件修改完了之后的话呢。



![](img/50e1fde6bd44518bea22bf919d035d2b_214.png)

是不是要嗯传递给别人，这边拷贝出去。

![](img/50e1fde6bd44518bea22bf919d035d2b_216.png)

那也就是说在我们的task下面的话呢，要去创建一个新的task吗，vim etc叫做ENERABLE，Rose，Index，叫做task，我的话呢随便去起一个名字，template压码文件哭。



![](img/50e1fde6bd44518bea22bf919d035d2b_218.png)

![](img/50e1fde6bd44518bea22bf919d035d2b_219.png)

然后的话呢里面去写什么东西呢，里面多起来还是比较简单的，第一个name什么东西，Copy config，比如说fire就好了，然后接下去我这边的话呢随便去选，选择一种，就是说这样子去写template。

temp alt冒号，然后这边的话呢叫做sauce，SRC它的话呢等于我本地的哪个文件呢，是不是这个etc unstable rose index叫做template，下面的NGINX增加二的一个文件。

这个文件我写我写全路径，你的话就写一个NGX也是可以的，因为它默认情况下就会去template，目录下面去找嘛，然后接下去BT是就放到对应的一个叫做位置，上面去，LS叫做etc nginx。

是不是就放到这个目录下，然后名字的话叫成index configure嘛对吧，这我们现在的话呢哦现在他还没有安装哈，没有关系，就这样子吧。



![](img/50e1fde6bd44518bea22bf919d035d2b_221.png)

就这个拷贝文件。

![](img/50e1fde6bd44518bea22bf919d035d2b_223.png)

好这边的话呢文件也拷贝完了。

![](img/50e1fde6bd44518bea22bf919d035d2b_225.png)

所有的任务的话呢也写完了，我们要做的事情，第五个是不是要去写主文件了呀，把这些playbook的话呢，我们把它整合在一起嘛，整合在一起去定义各个任务，它的一个前后关系，主文件定义任务前后关系。



![](img/50e1fde6bd44518bea22bf919d035d2b_227.png)

这个的话呢我们先是对一个叫做task，去进行一个定义的，所以这里我们先进入到这个叫做task目录当中，区域，有这么多个文件，aw不要哈，然后的话呢有1234这么多个文件，接下去的话，那我就来vim。

在这个目录下面，我要去编辑一个man点雅马文件，在这个文件里面的话呢，我们就去说明一下前后顺序是怎么样子的，就行了，稍等啊，哦那就这样子吧，应该我来看一下吧。

L s unstable rose index new task，等一下，好吧，在这里面的话呢，我们要做什么事情呢，Clude，第一个刚才说了，要调用的文件是我们的一个group文件吗。

接下去我们的比如说嗯group创建好了，是不是要去创建用户了呀，所以这里第二个文件，第二个执行的是我们的user文件，接下来u user文件执行好了之后呢，我们是不是要去安装我们的一个NX服务。

安装等一下，然后这边的话呢安装完了之后，我们要做的一个事情，是不是就把我们的模板文件把它给拷贝过去啊，嗯嗯对吧，那好模板文件做好了之后，我们要做的事情的话呢，是不是后续可以比如说去启动我们的服务啊。

或者重启我们的服务啊，你都可以去跟上嘛，就这样子就可以了好吧，保存退出。

![](img/50e1fde6bd44518bea22bf919d035d2b_229.png)

![](img/50e1fde6bd44518bea22bf919d035d2b_230.png)

这里的话呢就是说定义任务，它内部的一个前后关系，然后下面这边的话呢，比如说，我接下去是不是要去把整个角色去定义出来啊，角色去定义出来，这边的话呢稍微注意一下，我们这个定义角色的话呢。

它也是一个playbook，他这个的话呢和角色目录同级，啧啧啧。

![](img/50e1fde6bd44518bea22bf919d035d2b_232.png)

就比如说这边嘛啊，我们现在是不是一个叫做task co，他这个的就是说和我们的一个角色同级啊，你看我的角色是不是一个叫做angx new啊，对吧，那好我们这边的话呢就在这个目录下面。

就在这个叫做etc enable下面，就去创建一个roll文件就可以了，就说组文件就可以了，看一下CD，这里，然后这个时候vim比如说nginx roll点y ml，我现在的话呢就写一个简单的稍等哈。



![](img/50e1fde6bd44518bea22bf919d035d2b_234.png)

![](img/50e1fde6bd44518bea22bf919d035d2b_235.png)

里面的话呢我们现在这样子怎么去写呢，第一个HOSTERS是不是web2012，然后接下去remote user fruit吧，角色，我要去掉哪个角色呢，rule哪一个呢，是不是index。

叫做new这个角色啊，这样子就可以了。

![](img/50e1fde6bd44518bea22bf919d035d2b_237.png)

应用我们的一个角色，应用我们的一个角色。

![](img/50e1fde6bd44518bea22bf919d035d2b_239.png)

好我们现在的话呢就来测试一下，我们这个角色能不能去用吧，answerable playbook大C，然后呢etc enerable rule，然后的话呢跟上NGX叫做弱，诶难道我写错地方了哦。

多写了一个层级啊，index raw压码文件就可以了。

![](img/50e1fde6bd44518bea22bf919d035d2b_241.png)

我们看一下我们一些报错。

![](img/50e1fde6bd44518bea22bf919d035d2b_243.png)

如果没有报错的话呢，那我们就可以运行诶，看一下嗯，Line 138template，我来看一下他这里的话，如果你报错的话，那就比较好去检查了，Line is somebody may else，嗯啊。

Cp，这个可以吗，稍等一下，我看一下，这个不可以了，copy哦哦那个那个那个我写缩写了COPY，啧。

![](img/50e1fde6bd44518bea22bf919d035d2b_245.png)

我把这个文件重新去写一下，这里写的有点问题。

![](img/50e1fde6bd44518bea22bf919d035d2b_247.png)

等一下哈，他这边的话呢，我把整个去跑一下就好了，那好这边的话呢好像都可以都可以。

![](img/50e1fde6bd44518bea22bf919d035d2b_249.png)

但其中有两个任务的名字是一样掉了哈，就我的一个叫做start，还有一个叫做restart吗，它的名字是一样，我把restart这个给改一下吧。



![](img/50e1fde6bd44518bea22bf919d035d2b_251.png)

V i m e t c enerable rule index，New，叫做task restart，我把这个名字改一下。



![](img/50e1fde6bd44518bea22bf919d035d2b_253.png)

改成RE，虽然他没有报错。

![](img/50e1fde6bd44518bea22bf919d035d2b_255.png)

好然后现在的话呢人家都可以了，我就去运行一下嘛。

![](img/50e1fde6bd44518bea22bf919d035d2b_257.png)

好吧，然后最终的话呢我们去看一下结果像NGINX啊，有没有创建起来啊，NGINX的一个服务呢有没有启动起来啊，好吧稍等一下哈，呼，好。



![](img/50e1fde6bd44518bea22bf919d035d2b_259.png)

你看NGX是不是创建起来了，然后呢我们再来看net stn t u l p，去看一下NGINX，稍等哈，估计这边还没装好。



![](img/50e1fde6bd44518bea22bf919d035d2b_261.png)

就去进行各种检查了。

![](img/50e1fde6bd44518bea22bf919d035d2b_263.png)

我看一下啊，an apple哦，这边就不去start他，这等一下去看我们这边的话呢，来看一下它的一个配置文件信息，Etc nginx，NGINXCONFIG呃。

他这边的话呢就是unstable加22文件的话呢，是不是真的是拷贝过来了，然后稍等一下，我看一下，System control restart index，field那应该是在拷贝的时候出了问题。

copy他这边的话呢，过来的时候文件确实名字也改了，V应该是我那个拷贝命令应该是写错了，Enable，Task，它里面的一个叫做TMPLY，这应该是没有问题啊，TEMPLATE我再来试一下哈。

嗯我的话呢RM rf etc，嗯我把它给卸载掉吧，Ym remove index，大家稍等一下哈，我把这个服务给做完一下，应该是哪里有点小细节写错了，哦对对对对对对，是我突然间想到的是防火墙。

我没关他这端口的话，能默认就不能打开吗，是的，Set in first 0service system，Control stop firework，Set enforcing system。

Control stop forever，好我再来运行一遍。

![](img/50e1fde6bd44518bea22bf919d035d2b_265.png)

啧啧啧。

![](img/50e1fde6bd44518bea22bf919d035d2b_267.png)

妈妈，稍等啊，很快很快啦，好你看这边的话呢他也是拷贝过去了。

![](img/50e1fde6bd44518bea22bf919d035d2b_269.png)

所以这里的话呢不应该用那个copy，因为是一个template文件。

![](img/50e1fde6bd44518bea22bf919d035d2b_271.png)

哦我想一下先啊对。

![](img/50e1fde6bd44518bea22bf919d035d2b_273.png)

就这个文件，我刚才好像后面多了个S导致出错了。

![](img/50e1fde6bd44518bea22bf919d035d2b_275.png)

好诶，Unable，诶稍等一下，我看一下呃，System control respect injects，说那你把你写错了吗，Restarted，没问题啊，等一下，点击不了。

System control restart index，那这个服务的话呢，我到时候再去看一下哈，再去看一下system control is active index诶，等一下ym list。

Grape kk a ages，他这个已经安装起来了，那应该是我哪里有问题，你们的话呢课后自己去试一下，我下节课再跟你们说好吧，这节课的话呢留一个问题，你们自己去解决一下，去解决一下。



![](img/50e1fde6bd44518bea22bf919d035d2b_277.png)

好吧啊，这边的话呢刚才的一个问题是这样子的，就是嗯添加二的一个文件当中，他这边去进行一个相加的话呢。

![](img/50e1fde6bd44518bea22bf919d035d2b_279.png)

没有得到一个值，最终的话呢导致呃计算方面的话呢就有问题吗，下节课的话呢我们在讲这个模板文件的时候，会去讲一下肩加二的一个使用，我们再去看一下他怎么去进行一个加计算。



![](img/50e1fde6bd44518bea22bf919d035d2b_281.png)

好吧啊，这边启动了线，这边的话呢就可以进行一个正常启动了，把那个文件去改一下行吗。

![](img/50e1fde6bd44518bea22bf919d035d2b_283.png)

好了哈。