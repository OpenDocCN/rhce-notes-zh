# 华为云PaaS微服务治理技术 - P133：11-微服务治理-限流策略 - 开源之家 - BV1wm4y1M7m5

好，那么下边呢我们再来介绍一种策略，就是限流策略。好，那什么是限流策略呢？我们先来了解一下啊。呃，限流策略主要解决微服务之间的流量分配问题。啊，然后保证微服务在自己的资源池运行互不影响，这是啥意思呢？

呃，注意大家来看啊呃，假如说大家来看啊，这个这个是我的这个什么呀服务器啊。嗯，那在我的服务器大家都知道啊，这里边是运行了很多容器。😊，对不对？哎，运行了很多容器。好了。

那现在呢呃这个容器容器里边都是不是都是运行了我们的这个应用程序啊？假如说应用程序A应用程序怎么样B。😊，好了，嗯，那现在呢我们说呃现在这两个容器啊，这这两个容器去运行的时候，那我问你。😊，嗯。

他们呃是不是会使用这个服务器的资源？没错吧，哎，那么那这个资源是有限的。😊，对吧那如果说现在外边啊要来一次什么请求啊，要来一个请求。那么这个请求呢，它有请求A的是吧？对，那也有一些请求要请求B的。😊。

是吧而现在这个时候如果说A啊对所有的请求过来，他都去处理响应的话，那么我问你A，他是不是会用这个服务器的很多资源？😊，对，假如说这个资源呢对假如说这个资源呢它是一个池子，那么A和B共用这个资源池的话。

那么这个A它是不是会逐渐的逐渐的逐渐的把这些池子里边的这个资源都占用了？😊，那有如说是是是什么资源？那比如说各位每每过来一个请求，我是不是都要去启动一个县程来处理啊？对，那当我现在启动的线程越来越多。

这个请求的压力越来越大。那我这个服务器的资源，这个A他是不是吃的吃资源比较多呀？而此时这个B他再去用资源的话，是不是就没有资源可用啊？😊，懂我意思吧？

所以这个时候我们说为了保证整个服务器每个资源都对都互不影响的使用各自的资源，不能影响其他人的资源。这个时候呢我们可以对A啊以及B等这个服务器上的所有微服务呢，我们做限流。😊，那怎么限流呢？😡。

那我就可以呃根据这个业务场景，我们说呃。😊，A正常的情况下呃，它每秒请求的事务数假如说是100。好，那么我就在设置针对A的这个限流。这里边，我会设置它的QPS值为100。QPS就是每秒事务数啊。

每秒请求的事务数，每秒处理的事务数。那A呢，我最多每秒处理100个。对，如果再多的话，我就我就不处理了。因为这个值也是根据我们实际的业务需求来出发来考虑的。😡，懂我的意思吧？哎。

也就是说服务器就这么多资源，那我A呢我最多也就处理100个。B呢，假如说B呢，我就是我最多的处理那个多少个啊，200个。😊，哎，因为这个B呢可能它的事物的处理的时间非常短暂啊。

也就是很快那B呢最多处理200个。这样的话，我们是不是通过去限制这个QPS的值，那么就确定了这个A它的限流的这个什么每秒处理的事务数啊。😊，那我问你这样的话是不是就是说啊比如举个不恰当例子啊。

外边呢有一个攻击过来了，哎，来请求大量请求A。那我问你A是不是只处理100个，那再来每秒，如果多100个，它是不是就不再处理了。这样的话是不是就保证了我们这个服务器的资源。对。

我们保证了这个服务的资源不再滥用，对不对？哎，好了，那现在我们这个限流的策略呢，我们呃理解了什么是限流的策略之后呢，那好，我们现在就来测试一下啊，怎么测试呢？注意看啊，注意看呃，非常简单。😊。



![](img/90125c773cb86a63ff2bf1aaa9023899_1.png)

![](img/90125c773cb86a63ff2bf1aaa9023899_2.png)

因为这个限流的策略，这个限流的策略我们是在哪里呀？哎，这个消费方还是服务方呢？😊，对我提供服务A提供服务。哎，别人来调我，哎，那我这儿有限流，所以这里边注意看啊。

我点port viewport view是不是一个服务提供方呀？port view是不是提供网给网关提供服务，同时也给这个learning提供服务。看懂了吗？哎。

所以说你点击port view这个时候在限流这一栏点击新增。😊。

![](img/90125c773cb86a63ff2bf1aaa9023899_4.png)

![](img/90125c773cb86a63ff2bf1aaa9023899_5.png)

他会把所有消费他的这个服务消费方的这些服务都列出来了。你注意啊，刚才我们讲的负载均衡是不是针对服务的那个什么消费方来设置。现在我们讲的这个限流啊，我们针对服务的什么对提供方来设置。好了。

那现在假如说我要限制网关对我的访问，对我要限制网关对我的访问，我限制网关对我访问，我这怎么怎么测呀？😊，每秒1000个这这这我就是狂点，我这个好像应该点不过来吧。这样啊我为了测试方面。

我这个每秒我就设置一个。😊，有人说这啥意思呀？现在我这么一设置，是不是就是呃来源从网关过来的请求每秒最多是不是就是请求一次呀？如果再多的情况下，我问你这个post view他会受理吗？

他是不是不再受理了？😊，对啊，所以各位那现在我只要设置完了之后，那现在各位我们现在来测测吧，怎么测。😊。



![](img/90125c773cb86a63ff2bf1aaa9023899_7.png)

还是这个行不行？好，我现在就狂刷了啊，刷一个，没事吧，再刷。😡，再说给各位哎看。看。是不是就说因为这个限流的这个问题干嘛呀，是不是拒绝了哎。😊。



![](img/90125c773cb86a63ff2bf1aaa9023899_9.png)

就说你每秒请求一次，你会发现没事儿。😡，对你你你看你请求，因为我这个QPS是不是设的一呀？😡。

![](img/90125c773cb86a63ff2bf1aaa9023899_11.png)

没事，但是如果你这样。😡。

![](img/90125c773cb86a63ff2bf1aaa9023899_13.png)

点的很快。😡，你看他就挂了。这就是一种限流。

![](img/90125c773cb86a63ff2bf1aaa9023899_15.png)

对不对？😡，哎，但是各位我问你个问题啊。😡，现在我设置这个限流，是不是这个portto view针对网关过来的请求，我限制QPS是1呀。😡，但是我问你这个从这个learning过来的请求。

我问你我限制了吗？😡，没有吧，哎，没有。所以各位如果我现在要测试，从learning过过来请求这个port头 view。😡，那我我觉得应该是没有限制的，对不对啊，我们可以测试一下啊，可以测试一下。

看好啊。😊。

![](img/90125c773cb86a63ff2bf1aaa9023899_17.png)

嗯，怎么测呢？啊，这是认定嘛，但是这个认定他也经过网关了嘛。😡，对不对？他也经过网关了，那没关系，因为你限流是限的是什么？限的是portal view，哎，网关请求port view的流量。

而现在呢网关请求learning的流量是不是没有限制啊？所以我们就这么来刷吧，看好啊，刷一次看好，因为我每次刷一次，我每次刷一次，它是不是都要怎么弄，看好看好，我这都打日志了啊。

因为我每次一请求是取这个呃视频的播放地址，就是这个方法，这儿是不是打了一个日志啊？对你看好，这里边是不是就有日志啊。😊。



![](img/90125c773cb86a63ff2bf1aaa9023899_19.png)

![](img/90125c773cb86a63ff2bf1aaa9023899_20.png)

![](img/90125c773cb86a63ff2bf1aaa9023899_21.png)

对，所以你现在狂刷狂点，他也没事，因为你没有给他限流，看啊。😡，看懂了吗？没事儿，你看是不照常处理呀。哎，所以这就是我们说的这个限流，对不对？那有时候老师我也我也想给他限一下，看行不行，嗯。

怎怎么怎么限。😊。

![](img/90125c773cb86a63ff2bf1aaa9023899_23.png)

那简单呀，port view嘛，那你在port view这里看好，我再新增一个，新增针对谁呀？learning。😡，比如说这个亮点，我限制俩。😊，嗯。learning每秒最多俩。好了。

那现在我是不是限制住了吧，限制住了。好了，那现在我要我要来测试了啊，注意看我要来测试了。对我要一测试化网关，首先网关是不是要请求这个learning，他们之间是不是没有限流。

而learning再去请求portle view，我问你是不是就限流了？所以这个时候我们看它照样有反应。😊。



![](img/90125c773cb86a63ff2bf1aaa9023899_25.png)

![](img/90125c773cb86a63ff2bf1aaa9023899_26.png)

![](img/90125c773cb86a63ff2bf1aaa9023899_27.png)

等一会儿。你看看看看。

![](img/90125c773cb86a63ff2bf1aaa9023899_29.png)

看看没问题吧。对，这就是我们说的这个限流。对，有人说老师我我我限过流了，我现在我想放行，我不想限了咋办？😊。



![](img/90125c773cb86a63ff2bf1aaa9023899_31.png)

哎，我是不是要把它改大，你你要是彻底不阳线了，怎么弄啊，你删了就行了。😡，就来36。对你把他删了。

![](img/90125c773cb86a63ff2bf1aaa9023899_33.png)

这个就是我们说通通过云平台治理未服务的好处。你看我现在是不是三过了，对，三过了之后，各位稍等片刻，我们现在是不是就可以来怎么弄啊，测试了吧，来试试。😊。



![](img/90125c773cb86a63ff2bf1aaa9023899_35.png)

没事吧。再刷狂刷了啊。没问题吧。哎，看这个。😊，没事吧，狂说。

![](img/90125c773cb86a63ff2bf1aaa9023899_37.png)

没问题。对，所以这就是通过云平台来进行微服务治理的好处。哎，我们在一个这个配置中心我们配完，那么立即生效。



![](img/90125c773cb86a63ff2bf1aaa9023899_39.png)

好，以上呢就是我们讲解的这个限流的策略。限流主要用在哪呀？就是用来解决这个微服务的流量分配问题，是不是？哎，多个当多个微服务同时呃这个呃占用这个服务器的资源的时候呢。

哎我们一定建议大家啊在这个对根据业务场景的这个实际的这个情况需求，还有你的资源情况。我们对每个微服务都进行限流。好。😊。



![](img/90125c773cb86a63ff2bf1aaa9023899_41.png)

![](img/90125c773cb86a63ff2bf1aaa9023899_42.png)